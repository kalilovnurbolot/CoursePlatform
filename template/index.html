<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} | Платформа Онлайн-Курсов</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { display: flex; flex-direction: column; min-height: 100vh; background-color: #f7f9fb; }
        main { flex-grow: 1; }
        .hero-bg { background: linear-gradient(180deg, #ffffff 0%, #eef2ff 100%); }
        .modal-scroll::-webkit-scrollbar { width: 6px; }
        .modal-scroll::-webkit-scrollbar-track { background: transparent; }
        .modal-scroll::-webkit-scrollbar-thumb { background-color: #e5e7eb; border-radius: 20px; }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script> function toggleUserMenu() {
        const menu = document.getElementById('user-menu');
        menu.classList.toggle('hidden');
    }</script>
</head>
<body>

{{template "header" .}}

<main class="flex items-center justify-center main">

    <div class="hero-bg pt-20 pb-20 w-full">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">

            <h1 class="text-6xl sm:text-7xl lg:text-8xl font-extrabold text-gray-900 mb-6 leading-tight">
                Обучение, которое <span class="text-indigo-600">меняет жизнь</span>
            </h1>
            <p class="text-xl sm:text-2xl text-gray-700 mb-12 max-w-3xl mx-auto">
                Получите доступ к тысячам курсов от ведущих экспертов. Начните свой путь к успеху уже сегодня!
            </p>

            {{if .IsAuthenticated}}
            <a href="/personal" class="inline-flex items-center justify-center w-full sm:w-auto px-10 py-4 border border-transparent text-lg font-bold rounded-full shadow-2xl text-white bg-green-500 hover:bg-green-600 transition duration-300 transform hover:scale-105 hover:shadow-3xl">
                <i class="fas fa-user-circle mr-3"></i>
                Личный кабинет
            </a>
            {{else}}
            <a href="/auth/google/login"
               class="inline-flex items-center justify-center w-full sm:w-auto px-10 py-4 border border-transparent text-lg font-bold rounded-full shadow-2xl text-white
                      bg-indigo-600 hover:bg-indigo-700 transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50">
                <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12.48 10.92v3.84h5.28c-.18 1.08-.72 2.16-1.56 3l.06.06h4.5c2.7-2.46 4.2-6.18 4.2-10.8 0-1.8-.24-3.36-.72-4.8H12.48z" fill="#fff"/>
                    <path d="M7.48 12.48c0-.6.12-1.2.3-1.8H.72v3.6h5.88c.18-.9.3-1.8.3-2.4z" fill="#fff"/>
                    <path d="M12.48 24c3.3 0 6.06-1.08 8.04-2.94l-4.5-3.48c-1.2 1.08-2.7 1.62-4.5 1.62-3.3 0-6.18-2.22-7.2-5.1H.72c2.16 4.38 6.66 7.5 11.76 7.5z" fill="#fff"/>
                    <path d="M1.5 7.5c.3-1.2.78-2.28 1.44-3.3l-4.5-3.48C-1.2 3.84-2.4 7.44-2.4 11.4c0 3.6.84 6.66 2.34 9.3l4.8-3.66c-.48-.96-.78-2.04-.78-3.42z" fill="#fff"/>
                </svg>
                Войти через Google
            </a>
            <p class="mt-4 text-sm text-gray-500">
                Быстрая регистрация и вход всего в один клик.
            </p>
            {{end}}

        </div>
    </div>

    <div class="w-full bg-white py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold text-gray-900 text-center mb-12">
                Почему выбирают нас?
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">

                <div class="text-center p-6 bg-gray-50 rounded-lg shadow-md hover:shadow-xl transition duration-300">
                    <i class="fas fa-graduation-cap text-4xl text-indigo-500 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">Качественный Контент</h3>
                    <p class="text-gray-600">Курсы, разработанные практикующими профессионалами индустрии.</p>
                </div>

                <div class="text-center p-6 bg-gray-50 rounded-lg shadow-md hover:shadow-xl transition duration-300">
                    <i class="fas fa-mobile-alt text-4xl text-indigo-500 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">Доступ 24/7</h3>
                    <p class="text-gray-600">Учитесь в удобное для вас время, с любого устройства.</p>
                </div>

                <div class="text-center p-6 bg-gray-50 rounded-lg shadow-md hover:shadow-xl transition duration-300">
                    <i class="fas fa-certificate text-4xl text-indigo-500 mb-4"></i>
                    <h3 class="text-xl font-semibold mb-2">Сертификаты</h3>
                    <p class="text-gray-600">Получайте сертификаты, подтверждающие ваши новые навыки.</p>
                </div>

            </div>
        </div>
    </div>
</main>
<section id="courses" class="py-20 bg-gray-50">
    <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
            {{range $index, $course := .Courses}}
            {{$colorClass := index $.ColorPool (mod $index (len $.ColorPool))}}

            <div onclick="openModal(this)"
                 class="group bg-white rounded-2xl overflow-hidden border border-gray-100 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 flex flex-col h-full cursor-pointer"
                 data-id="{{$course.ID}}"
                 data-title="{{$course.Title}}"
                 data-author="{{$course.Author.Name}}"
                 data-author-img="{{$course.Author.Picture}}">

                <div class="relative h-48 bg-gradient-to-br {{$colorClass}} flex items-center justify-center overflow-hidden">
                    <div class="absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-20 transition-opacity duration-300"></div>
                </div>

                <div class="p-6 flex flex-col flex-grow">
                    <h3 class="text-xl font-bold text-gray-900 leading-tight mb-3 line-clamp-2 group-hover:text-blue-600 transition-colors">
                        {{$course.Title}}
                    </h3>
                        <div class="mt-auto pt-4 flex items-center border-t border-gray-50">
                            <div class="flex-shrink-0">
                                <img class="h-10 w-10 rounded-full object-cover border-2 border-white shadow-sm"
                                     src="{{$course.Author.Picture}}"
                                     alt="{{$course.Author.Name}}">
                            </div>
                            <div class="ml-3">
                                <p class="text-sm font-semibold text-gray-800">
                                    {{$course.Author.Name}}
                                </p>
                                <p class="text-xs text-gray-500">Автор курса</p>
                            </div>
                        </div>
                </div>
            </div>
            {{end}}
        </div>
    </div>
</section>
<section id="about" class="py-24 bg-white overflow-hidden">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">

            <div>
                <p class="text-blue-600 font-semibold tracking-wide uppercase text-sm mb-2">Наша миссия</p>
                <h2 class="text-4xl md:text-5xl font-bold text-gray-900 leading-tight mb-6">
                    Создаем образование <br>
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-gray-900 to-gray-500">нового уровня</span>
                </h2>
                <p class="text-lg text-gray-600 mb-8 leading-relaxed">
                    Мы не просто платформа, а сообщество экспертов. Наша цель — передавать знания в максимально удобной, естественной и эффективной форме. Мы верим в простоту технологий и глубину контента.
                </p>

                <div class="grid grid-cols-3 gap-8 border-t border-gray-100 pt-8">
                    <div>
                        <span class="block text-3xl font-bold text-gray-900">5+</span>
                        <span class="text-sm text-gray-500">Лет опыта</span>
                    </div>
                    <div>
                        <span class="block text-3xl font-bold text-gray-900">10k</span>
                        <span class="text-sm text-gray-500">Студентов</span>
                    </div>
                    <div>
                        <span class="block text-3xl font-bold text-gray-900">24/7</span>
                        <span class="text-sm text-gray-500">Поддержка</span>
                    </div>
                </div>
            </div>

            <div class="relative">
                <div class="absolute -top-4 -right-4 w-24 h-24 bg-gray-100 rounded-full blur-2xl opacity-50"></div>
                <div class="relative rounded-2xl overflow-hidden shadow-2xl">
                    <img src="https://images.unsplash.com/photo-1522071820081-009f0129c71c?ixlib=rb-1.2.1&auto=format&fit=crop&w=800&q=80"
                         alt="Team working"
                         class="w-full h-full object-cover transform hover:scale-105 transition-transform duration-700">
                </div>
            </div>

        </div>
    </div>
</section>

<section id="contact" class="py-24 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">

        <div class="text-center max-w-2xl mx-auto mb-16">
            <h2 class="text-3xl font-bold text-gray-900 mb-4">Свяжитесь с нами</h2>
            <p class="text-gray-500 text-lg">
                Мы всегда на связи. Выберите удобный мессенджер, и мы ответим в течение 15 минут.
            </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">

            <a href="https://wa.me/79990000000" target="_blank" class="group bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl border border-gray-100 transition-all duration-300 flex flex-col items-center text-center relative overflow-hidden">
                <div class="absolute inset-0 bg-green-50 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>

                <div class="relative w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mb-6 group-hover:scale-110 transition-transform duration-300">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
                </div>

                <h3 class="relative text-xl font-bold text-gray-900 mb-2">WhatsApp</h3>
                <p class="relative text-gray-500 mb-4">Быстрый ответ на вопросы</p>
                <span class="relative text-green-600 font-semibold group-hover:underline decoration-2 underline-offset-4">Написать сообщение &rarr;</span>
            </a>

            <a href="https://t.me/yourusername" target="_blank" class="group bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl border border-gray-100 transition-all duration-300 flex flex-col items-center text-center relative overflow-hidden">
                <div class="absolute inset-0 bg-blue-50 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>

                <div class="relative w-16 h-16 bg-blue-100 text-blue-500 rounded-full flex items-center justify-center mb-6 group-hover:scale-110 transition-transform duration-300">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 11.944 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/></svg>
                </div>

                <h3 class="relative text-xl font-bold text-gray-900 mb-2">Telegram</h3>
                <p class="relative text-gray-500 mb-4">Наш канал и поддержка</p>
                <span class="relative text-blue-500 font-semibold group-hover:underline decoration-2 underline-offset-4">Перейти в чат &rarr;</span>
            </a>

            <a href="https://instagram.com/yourusername" target="_blank" class="group bg-white rounded-2xl p-8 shadow-sm hover:shadow-xl border border-gray-100 transition-all duration-300 flex flex-col items-center text-center relative overflow-hidden">
                <div class="absolute inset-0 bg-pink-50 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>

                <div class="relative w-16 h-16 bg-pink-100 text-pink-600 rounded-full flex items-center justify-center mb-6 group-hover:scale-110 transition-transform duration-300">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.069-4.85.069-3.204 0-3.584-.012-4.849-.069-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.069-1.644-.069-4.849 0-3.204.012-3.584.069-4.849.149-3.225 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zm0 10.162a3.997 3.997 0 110-7.994 3.997 3.997 0 010 7.994zm5.338-9.32a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg>
                </div>

                <h3 class="relative text-xl font-bold text-gray-900 mb-2">Instagram</h3>
                <p class="relative text-gray-500 mb-4">Фотоотчеты и жизнь школы</p>
                <span class="relative text-pink-600 font-semibold group-hover:underline decoration-2 underline-offset-4">Подписаться &rarr;</span>
            </a>

        </div>

        <div class="text-center mt-12">
            <p class="text-gray-400 text-sm">
                Предпочитаете почту? <a href="mailto:hello@example.com" class="text-gray-600 font-semibold hover:text-black transition-colors">hello@example.com</a>
            </p>
        </div>
    </div>
</section>
{{template "footer" .}}

<div id="course-modal-overlay" onclick="closeModal()" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-40 opacity-0 pointer-events-none transition-opacity duration-300"></div>

<div id="course-modal-panel" class="fixed bottom-0 left-0 right-0 z-50 bg-white rounded-t-3xl shadow-[0_-10px_40px_rgba(0,0,0,0.2)] transform translate-y-full transition-transform duration-500 cubic-bezier(0.32, 0.72, 0, 1) max-h-[90vh] flex flex-col">

    <div class="pt-4 pb-2 flex justify-center cursor-pointer flex-shrink-0" onclick="closeModal()">
        <div class="w-12 h-1.5 bg-gray-200 rounded-full"></div>
    </div>

    <div class="p-6 md:p-8 overflow-y-auto modal-scroll">
        <div class="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12">

            <div class="flex flex-col">
                <p class="text-sm text-blue-600 font-bold uppercase tracking-wider mb-2">Обзор курса</p>

                <h2 id="modal-title" class="text-2xl md:text-3xl font-bold text-gray-900 mb-4 leading-tight">Загрузка...</h2>

                <div class="flex items-center space-x-3 mb-6">
                    <img id="modal-author-img" src="" class="w-10 h-10 rounded-full object-cover border border-gray-100">
                    <div>
                        <p class="text-sm text-gray-500">Автор</p>
                        <p id="modal-author-name" class="font-medium text-gray-900">...</p>
                    </div>
                </div>

                <p id="modal-desc" class="text-gray-500 text-sm leading-relaxed mb-8">Описание загружается...</p>

                <hr class="border-gray-100 mb-6">

                <div>
                    <h3 class="font-bold text-gray-900 mb-4 text-lg">Программа курса</h3>

                    <div id="modal-loader" class="flex justify-center py-6 hidden">
                        <svg class="animate-spin h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                    </div>

                    <div id="modal-syllabus" class="space-y-4"></div>
                </div>
            </div>

            <div class="md:sticky md:top-0">
                <div class="bg-gray-50 rounded-2xl p-6 md:p-8 border border-gray-100">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">Доступ к курсу</h3>

                    <div id="modal-action-area" class="space-y-4"></div>

                    <p class="text-xs text-center text-gray-400 mt-3">
                        Обучение проходит на нашей платформе.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const overlay = document.getElementById('course-modal-overlay');
    const panel = document.getElementById('course-modal-panel');
    const mLoader = document.getElementById('modal-loader');
    const mSyllabus = document.getElementById('modal-syllabus');

    // Глобальная переменная для ID текущего курса
    let currentCourseId = null;

    function closeModal() {
        overlay.classList.remove('opacity-100', 'pointer-events-auto');
        overlay.classList.add('opacity-0', 'pointer-events-none');
        panel.classList.remove('translate-y-0');
        panel.classList.add('translate-y-full');
        document.body.style.overflow = '';
    }

    async function openModal(element) {
        const id = element.getAttribute('data-id');
        const title = element.getAttribute('data-title');
        const author = element.getAttribute('data-author');
        const authorImg = element.getAttribute('data-author-img');

        currentCourseId = id; // Запоминаем ID

        // UI Reset
        document.getElementById('modal-title').textContent = title;
        document.getElementById('modal-author-name').textContent = author;
        document.getElementById('modal-author-img').src = authorImg;
        document.getElementById('modal-desc').textContent = "Загрузка...";
        document.getElementById('modal-action-area').innerHTML = ''; // Очищаем кнопки

        mLoader.classList.remove('hidden');
        mSyllabus.classList.add('hidden');
        mSyllabus.innerHTML = '';

        overlay.classList.remove('pointer-events-none', 'opacity-0');
        overlay.classList.add('pointer-events-auto', 'opacity-100');
        panel.classList.remove('translate-y-full');
        panel.classList.add('translate-y-0');
        document.body.style.overflow = 'hidden';

        try {
            // Запрос к API
            const response = await fetch(`/api/courses/${id}/structure`);
            if (!response.ok) throw new Error('Ошибка сети');

            const data = await response.json();

            // Получаем данные из новой структуры ответа
            const course = data.course;
            const isAuth = data.is_auth;
            const reqStatus = data.request_status;

            // 1. Описание
            document.getElementById('modal-desc').textContent = course.description || "Описание отсутствует.";

            // 2. Программа (берем из course.modules)
            if (course.modules && course.modules.length > 0) {
                let html = '';
                course.modules.forEach((mod, modIndex) => {
                    html += `
                        <div class="mb-6 last:mb-0">
                            <h4 class="text-sm font-bold text-gray-800 mb-2 flex items-center uppercase tracking-wide">
                                <span class="bg-blue-100 text-blue-700 text-xs px-2 py-0.5 rounded mr-2">Модуль ${modIndex + 1}</span>
                                ${mod.title}
                            </h4>
                            <div class="space-y-1 border-l-2 border-gray-100 ml-2 pl-4">
                    `;
                    if (mod.lessons && mod.lessons.length > 0) {
                        mod.lessons.forEach(lesson => {
                            html += `
                                <div class="flex items-start py-1">
                                    <div class="w-1.5 h-1.5 rounded-full bg-blue-400 mt-2 mr-2 flex-shrink-0"></div>
                                    <span class="text-gray-600 text-sm leading-snug">${lesson.title}</span>
                                </div>
                            `;
                        });
                    } else {
                        html += `<div class="text-sm text-gray-400 italic">Нет уроков</div>`;
                    }
                    html += `</div></div>`;
                });
                mSyllabus.innerHTML = html;
            } else {
                mSyllabus.innerHTML = '<p class="text-gray-400 text-sm">Программа уточняется.</p>';
            }

            // 3. ЛОГИКА КНОПОК
            const actionArea = document.getElementById('modal-action-area');

            if (!isAuth) {
                // Гость -> Кнопка "Войти"
                actionArea.innerHTML = `
                    <div class="bg-blue-50 border border-blue-100 rounded-xl p-4 mb-3">
                        <p class="text-sm text-blue-800">Чтобы подать заявку, необходимо войти.</p>
                    </div>
                    <a href="/auth/google/login" class="w-full bg-indigo-600 text-white font-bold py-3.5 rounded-xl shadow-lg hover:bg-indigo-700 transition-all flex justify-center items-center">
                        <i class="fab fa-google mr-2"></i> Войти через Google
                    </a>
                `;
            } else {
                // Авторизован
                if (reqStatus === 'pending') {
                    // Заявка уже есть -> Статус "Ожидание"
                    actionArea.innerHTML = `
                        <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 text-center">
                            <p class="text-yellow-800 font-bold mb-1"><i class="fas fa-clock mr-2"></i>Заявка отправлена</p>
                            <p class="text-xs text-yellow-600">Ожидайте одобрения администратора.</p>
                        </div>
                        <button disabled class="w-full mt-3 bg-gray-200 text-gray-400 font-bold py-3.5 rounded-xl cursor-not-allowed">
                            Заявка на рассмотрении
                        </button>
                    `;
                } else if (reqStatus === 'approved') {
                    // Одобрено -> Кнопка "Учиться"
                    actionArea.innerHTML = `
                        <div class="bg-green-50 border border-green-200 rounded-xl p-4 text-center mb-4">
                            <p class="text-green-800 font-bold">Вы зачислены на курс!</p>
                        </div>
                        <a href="/course/${course.id}/learn" class="w-full bg-green-600 text-white font-bold py-3.5 rounded-xl shadow-lg hover:bg-green-700 transition-all flex justify-center items-center">
                            Перейти к обучению
                        </a>
                    `;
                } else {
                    // Нет заявки -> Кнопка "Отправить"
                    actionArea.innerHTML = `
                        <button onclick="submitEnrollment()" id="btn-submit" class="w-full bg-gray-900 text-white font-bold py-3.5 rounded-xl shadow-lg hover:bg-black hover:-translate-y-0.5 transition-all duration-200 flex justify-center items-center group">
                            <span>Отправить заявку</span>
                            <svg class="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path></svg>
                        </button>
                    `;
                }
            }

            mLoader.classList.add('hidden');
            mSyllabus.classList.remove('hidden');

        } catch (error) {
            console.error(error);
            mLoader.classList.add('hidden');
            mSyllabus.innerHTML = '<p class="text-red-500 text-sm">Не удалось загрузить данные.</p>';
            mSyllabus.classList.remove('hidden');
        }
    }

    // Отправка заявки (POST)
    async function submitEnrollment() {
        if (!currentCourseId) return;
        const btn = document.getElementById('btn-submit');
        const originalText = btn.innerHTML;

        btn.disabled = true;
        btn.innerHTML = `<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;

        try {
            const response = await fetch('/api/enroll', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ course_id: parseInt(currentCourseId) })
            });

            if (response.ok) {
                // Успех -> Меняем вид кнопки вручную
                const actionArea = document.getElementById('modal-action-area');
                actionArea.innerHTML = `
                    <div class="bg-green-100 border border-green-200 rounded-xl p-4 text-center animate-pulse">
                        <p class="text-green-800 font-bold">Успешно!</p>
                    </div>
                `;
                setTimeout(() => {
                    actionArea.innerHTML = `
                        <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 text-center">
                            <p class="text-yellow-800 font-bold mb-1"><i class="fas fa-clock mr-2"></i>Заявка отправлена</p>
                            <p class="text-xs text-yellow-600">Ожидайте одобрения администратора.</p>
                        </div>
                        <button disabled class="w-full mt-3 bg-gray-200 text-gray-400 font-bold py-3.5 rounded-xl cursor-not-allowed">
                            Заявка на рассмотрении
                        </button>
                    `;
                }, 1000);
            } else if (response.status === 401) {
                window.location.href = "/auth/google/login";
            } else {
                alert("Ошибка отправки.");
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        } catch (e) {
            console.error(e);
            btn.innerHTML = originalText;
            btn.disabled = false;
        }
    }
</script>
</body>
</html>